---
title: "Sample project 1"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  word_document:
    toc: yes
  html_document:
    author: "Yuxiang Chi"
    theme: flatly
    toc: yes
    toc_float: yes
    code_download: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE, cache = F}
knitr::opts_chunk$set(
  echo = TRUE,
  error = TRUE,
  warning= FALSE,
  message= FALSE)
```

```{r, include=FALSE}
# load libs 
packages <- c("tidyverse", "dplyr", "lubridate")
install.packages(setdiff(packages, rownames(installed.packages())))  
library(tidyverse)
library(lubridate)
# Import data

US_accidents <- read_csv("data/US_accidents.csv", 
    col_types = cols(Start_Time = col_datetime(format = "%m/%d/%Y %H:%M"), 
        End_Time = col_datetime(format = "%m/%d/%Y %H:%M"), 
        Weather_Timestamp = col_datetime(format = "%m/%d/%Y %H:%M")))

```

## Dataset description
This is a countrywide car accident dataset, which covers 49 states of the USA. The accident data are collected from February 2016 to Dec 2020, there are about 4.2 million accident records in this dataset.
We are using this dataset to analyze the accidents happened in US and what factors are impacting it.


## Column description
| Column Name    | Description |
| ----------- | ----------- |
| Col1 | Demo |


## Story line
first, i would like to understand if the accident is more likely to happen in weekdays or weekends. so create a new column day of week based on accident start time and count the accident by day of week. we plot the number of accident by day of week in a bar chart and it shows daily accidents in weekdays is almost tripped than weekends.

```{r}
# create day of week and data frame
US_accidents$day_of_week <- weekdays(as.Date(US_accidents$Start_Time))
data.frame(table(US_accidents$day_of_week))

```

Then, we would like to analyze if the accident is happened more often during the rush hours in the weekdays. we first extract the hour of the accident start time and then filtered the data by only weekdays. lastly we plot the histogram of the accident by accident start hour. From the histogram, we can see the accident during the daytime is higher than night time since the cars on the road during the day time is more than night time. Also the accidents happened much more during rush hours especially in the morning which could be a reason for bad traffic in the morning.
```{r}
US_accidents$Start_hour <- hour(US_accidents$Start_Time)
weekday_accident <- filter(US_accidents, day_of_week %in% c("Saturday","Sunday")==FALSE)
hist(weekday_accident$Start_hour, breaks=seq(0,23,1), xlab = "Accident Start Hour", ylab = "Number of Accidents", main = "Histogram of Accident Start Hour")
```

We also would like to analyze if the population and geography have impact on the accidents. Our hypotheses is the large city will have more accidents than other cities or towns due to large population. so we first count the accident by each city state and ordered by the number of accident from largest to smallest. As we can see from the results, top 10 city by number of accidents are comparably large cities but not exactly match with top 10 by population. It shows top 3 are all from Texas state.
```{r}
# group by 2 col, and count 
accidentbycity <- data.frame(table(US_accidents$City
                 , US_accidents$State))
top_n(accidentbycity[order(accidentbycity$Freq, decreasing = TRUE),],10) 
```



How many accidents occurred in day and night time and what was the Severity during that time?

```{r}
data.frame(table(US_accidents$Severity))
ggplot(data = US_accidents)+
  geom_bar(mapping = aes(x = Severity))+
  facet_wrap(~Sunrise_Sunset)
```
The aim of this analysis is to find out and derive accident mostly occurs in the daytime and severity is also higher in compare to night. As per graph we can see most of time severity level 2 and 3 are higher.


```{r}
interval <- interval(strptime(US_accidents$Start_Time, "%Y-%m-%d %H:%M:%S"), strptime(US_accidents$End_Time, "%Y-%m-%d %H:%M:%S"))
US_accidents$time_in_hours <- time_length(interval, unit = "hour")
hour_span <- US_accidents %>% group_by(Severity)
hour_span %>% summarise(
  hour_span = mean(time_in_hours, na.rm = TRUE),
)
```

We would like to find out the weather condition in which most accidents occur. Our hypotheses is that more accidents are likely to happen when the weather condition is bad.

```{r}
# Methods used in this research
# group by col, and count the frequency of number of weather conditions
WeatherAcc_Count <- data.frame(table(US_accidents$Weather_Condition))
top_n(WeatherAcc_Count[order(WeatherAcc_Count$Freq, decreasing = TRUE),],10)
# WeatherAcc_Count[order(WeatherAcc_Count$Freq, decreasing = TRUE),]

```

## Conclusion 

